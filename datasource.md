# Data Source Breakdown

This document summarizes where each dataset came from, which variables were used, how they were retrieved, recent processing actions, and where raw/processed files live in the project.

---

## Project scripts (entry points)

- `setup_data_project.py` — creates folder structure, downloads climate & CO₂ (with fallbacks), ingests user FAOSTAT CSV (or creates template), writes metadata, and generates `data_processing.ipynb`.
- `run_incremental_fetch.py` / `run_incremental_resilient.py` — region-by-region climate fetchers that save progress after each region.
- `process_data_now.py` — runs preprocessing steps to produce final LSTM/FNN/hybrid CSV outputs (same logic as the notebook).
- `create_dataset_structure.py` — idempotent folder creation.
- `convert_faostat_to_project.py` — converts user FAOSTAT export into the project's `Year,Crop,Yield` CSV format.
- `fix_monthly_filter.py` — utility that removes non-calendar-month rows (e.g., `Month==13`) from NASA POWER monthly exports.

---

## Time range and resolution

- Time period: 1990–2023 (inclusive)
- Climate: monthly (NASA POWER monthly endpoint)
- CO₂: annual (Our World in Data used as fallback to World Bank)
- Crop yields: annual (FAOSTAT — user-provided CSV ingested)

---

## Regions

Six geopolitical regions used for Nigeria (central coordinates used for point queries):

- North Central — (8.5, 7.0)
- North East — (11.8, 13.1)
- North West — (12.0, 7.5)
- South East — (6.0, 7.5)
- South South — (5.0, 6.0)
- South West — (6.5, 3.5)

These are used as single-point queries to NASA POWER and annotated with a `Region` column.

---

## Climate data — NASA POWER

- Endpoint: `https://power.larc.nasa.gov/api/temporal/monthly/point`
- Variables requested: `PRECTOTCORR` (rainfall, mm), `T2M` (avg temp, °C), `T2M_MAX`, `T2M_MIN`
- Temporal scope: monthly, 1990–2023
- Retrieval: point queries per region coordinate; JSON responses parsed into a DataFrame and reshaped to columns `Year`, `Month`, and variable columns.
- Missing/value handling: numeric parsing with `errors='coerce'` to produce `NaN`; aggregation uses `np.nansum`, `np.nanmean`, `np.nanmax`.

Saved raw climate CSV:

- `data/lstm_dataset/raw/regional_monthly_climate_nigeria.csv` (cleaned to contain only months 1..12)

Aggregated annual climate features (derived by summing/averaging monthly values):

- `data/fnn_dataset/processed/regional_annual_climate_features.csv`

Notes: the retrieval uses retries and short sleeps; an incremental runner saves each region after download so partial progress is preserved.

---

## CO₂ data — World Bank attempted, OWID fallback

- Attempted indicator: `EN.ATM.CO2E.KT` via World Bank API (HTTP API). During earlier runs the World Bank API returned "indicator not found" for that indicator.
- Fallback used: Our World in Data CO₂ dataset (CSV): https://github.com/owid/co2-data — CO₂ reported in metric tons; converted to kilotonnes (kt) where needed.

Saved CO₂ CSV (OWID fallback):

- `data/fnn_dataset/raw/nigeria_co2_emissions.csv`

Notes: if you prefer a different CO₂ source (e.g., a World Bank extract), place it at `data/fnn_dataset/raw/nigeria_co2_emissions.csv` and re-run `process_data_now.py`.

---

## Crop yield data — FAOSTAT (user-provided)

- Crops expected: Maize, Cassava, Yam
- The project ingested the FAOSTAT file `FAOSTAT_data_en_12-16-2025.csv` supplied by the user and converted it to `data/fnn_dataset/raw/nigeria_crop_yields.csv` using `convert_faostat_to_project.py`.
- The FAOSTAT-derived file contains official FAO yields (kg/ha) for 1990–2023 and has been copied into the hybrid raw folder as well.

Ingested file location:

- `data/fnn_dataset/raw/nigeria_crop_yields.csv`
- Hybrid copy: `data/hybrid_dataset/fnn_dataset/raw/nigeria_crop_yields.csv`

To update or replace yields, place a new FAOSTAT export at the repository root named like the original and re-run `convert_faostat_to_project.py` and `process_data_now.py`.

---

## Processed outputs (model inputs)

- LSTM input (monthly sequences):
  - `data/lstm_dataset/sequences/lstm_monthly_sequences.csv`

- FNN input (annual features):
  - `data/fnn_dataset/processed/fnn_features.csv`

- Hybrid inputs (copies placed under `hybrid_dataset/`):
  - `data/hybrid_dataset/lstm_dataset/sequences/lstm_monthly_sequences.csv`
  - `data/hybrid_dataset/fnn_dataset/processed/hybrid_fnn_features.csv`

All processed files are generated by `process_data_now.py` (mirrors notebook logic). Re-run this script after updating raw inputs to refresh outputs.

---

## Recent processing & validation (2025-12-16)

- FAOSTAT import: `convert_faostat_to_project.py` ingested the user's FAOSTAT CSV into the project format.
- Month==13 rows removed: `fix_monthly_filter.py` removed extraneous month rows from NASA POWER export so each (Year,Region) now has 12 months.
- Processing re-run: `process_data_now.py` regenerated annual and LSTM outputs.
- Validation: `validate_datasets.py` confirmed years 1990–2023, all six regions present, no missing crop yields, and 12 months per year-region.

---

## Missing values and alignment

- Year alignment: all annual files are aligned to the 1990–2023 range. Missing years are handled by interpolation/fill during FNN building.
- Missing climate values are left as `NaN` during aggregation; `np.nansum` and `np.nanmean` are used to compute annual features robustly.
- FNN building uses linear interpolation across years and then fills remaining numeric `NaN`s with the column mean.

---

## Provenance & reproducibility

Run these commands to reproduce the latest ingestion and processing locally:

```bash
pip install requests pandas numpy
python convert_faostat_to_project.py
python fix_monthly_filter.py
python process_data_now.py
python validate_datasets.py
```

The notebook `data_processing.ipynb` contains the same processing logic and a run log documenting these steps.

---

## Notes and recommendations

- OWID was used as a reliable fallback for CO₂ when the World Bank indicator could not be retrieved automatically. Replace with your preferred source if needed.
- The FAOSTAT file you provided is authoritative and has been used in processing. Any earlier template placeholders were replaced.
- If you want tighter provenance, we can extract FAO `Flag`/`Note` columns into `data/fnn_dataset/metadata/` and store the original FAOSTAT CSV under `data/originals/`.

File: [datasource.md](datasource.md)
